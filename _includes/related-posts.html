<!-- Related Posts
================================================== -->
<div class="{% unless page.categories == empty %}related-posts{% endunless %}">  

{% unless page.categories == empty %}
<h2 class="text-center mb-4">
{% if page.lang == "en" %}
  Explore more like this
{% elsif page.lang == "de" %}
  Entdecken Sie mehr davon
{% elsif page.lang == "es" %}
  Explora más contenido similar
{% elsif page.lang == "ko" %}
  이와 비슷한 글
{% elsif page.lang == "zh-hant" %}
  類似文章推薦
{% elsif page.lang == "fr" %}
  Découvrez plus d’articles similaires
{% else %}
  こちらもおすすめ
{% endif %}
</h2>
{% endunless %}

{% comment %} language path {% endcomment %}
{% assign lang_path = "" %}
{% if page.lang and page.lang != "ja" %}
  {% assign lang_path = page.lang | append: "/" %}
{% endif %}

<div class="d-flex justify-content-center align-items-center">

<!-- Categories -->
{% if page.categories and page.categories.size > 0 %}
  {% assign sortedCategories = page.categories | sort %}
  {% for category in sortedCategories %}
    <a class="smoothscroll badge badge-primary text-capitalize"
       href="{{ site.baseurl }}/{{ lang_path }}categories#{{ category | slugify }}">
      {{ category }}
    </a>
  {% endfor %}
{% endif %}


<!-- Tags -->
{% if page.tags and page.tags.size > 0 %}
  {% assign sortedTags = page.tags | sort %}
  {% for tag in sortedTags %}
    <a class="smoothscroll badge badge-primary text-capitalize"
       href="{{ site.baseurl }}/{{ lang_path }}tags#{{ tag | slugify }}">
      {{ tag }}
    </a>
  {% endfor %}
{% endif %}


</div>

{% assign maxRelated = 12 %}
{% assign minCommonTags = 2 %}
{% assign maxRelatedCounter = 0 %}
{% assign current_lang = page.lang | default: "ja" %}

<div class="blog-grid-container">

{% for post in site.posts %}
  {% if post.url != page.url and post.lang == current_lang %}

    {% assign sameTagCount = 0 %}

    {% for tag in post.tags %}
      {% if page.tags contains tag %}
        {% assign sameTagCount = sameTagCount | plus: 1 %}
      {% endif %}
    {% endfor %}

    {% if sameTagCount >= minCommonTags %}
      {% include postbox.html %}
      {% assign maxRelatedCounter = maxRelatedCounter | plus: 1 %}
      {% if maxRelatedCounter >= maxRelated %}
        {% break %}
      {% endif %}
    {% endif %}

  {% endif %}
{% endfor %}

</div>
</div>
