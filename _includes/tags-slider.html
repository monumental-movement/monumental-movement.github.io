<div class="tag-slider">
  {% if page.lang == 'en' %}
    {% assign posts = site.en_posts.docs %}
  {% else %}
    {% assign posts = site.posts %}
  {% endif %}

  {% assign tags = "" | split: "" %}
  {% for post in posts %}
    {% if post.tags %}
      {% for tag in post.tags %}
        {% assign tag_normalized = tag | strip %}
        {% unless tags contains tag_normalized %}
          {% assign tags = tags | push: tag_normalized %}
        {% endunless %}
      {% endfor %}
    {% endif %}
  {% endfor %}

  {% assign tags = tags | sort %}
  {% assign total = tags | size %}

  {% if tags.size > 0 %}
    {% for row in (1..3) %}
      {% assign offset = row | times: total | divided_by: 4 | round %}
      {% assign rotated = tags | slice: offset, total | concat: tags | slice: 0, offset %}
      <div class="scroll-row row{{ row }}">
        {% for tag in rotated %}
          <a href="{% if page.lang == 'en' %}{{ site.baseurl }}/en/tags#{{ tag | uri_escape }}{% else %}{{ site.baseurl }}/tags#{{ tag | uri_escape }}{% endif %}" class="tag row{{ row }}">
            #{{ tag }}
          </a>
        {% endfor %}
        {% for tag in rotated %}
          <a href="{% if page.lang == 'en' %}{{ site.baseurl }}/en/tags#{{ tag | uri_escape }}{% else %}{{ site.baseurl }}/tags#{{ tag | uri_escape }}{% endif %}" class="tag clone row{{ row }}">
            #{{ tag }}
          </a>
        {% endfor %}
      </div>
    {% endfor %}
  {% else %}
    <p style="color:#999; text-align:center;">(No tags found)</p>
  {% endif %}
</div>

<style>
/* === スライダー全体 === */
.tag-slider {
  overflow: hidden;
  position: relative;
  padding: 8px 0;
}

/* === 横スクロール行 === */
.scroll-row {
  display: inline-block;
  white-space: nowrap;
  margin: 4px 0;
  animation: scroll-loop 180s linear infinite;
  will-change: transform;
}

/* ホバーで停止 */
.tag-slider:hover .scroll-row {
  animation-play-state: paused;
}

/* === タグ共通 === */
.tag {
  display: inline-block;
  margin: 0 6px;
  padding: 4px 10px;
  border-radius: 18px;
  font-size: 0.85rem;
  text-decoration: none;
  white-space: nowrap;
  transition: transform 0.3s, box-shadow 0.3s, background 0.5s, color 0.5s;
}

/* --- 1段目：グラデ背景 --- */
.tag.row1 {
  background: linear-gradient(135deg, #ff7a00, #ffb347);
  border: 1px solid #ff7a00;
  color: #fff;
}
.tag.row1:hover {
  transform: scale(1.08);
  box-shadow: 0 0 12px rgba(255, 122, 0, 0.7);
}

/* --- 2段目：枠線のみ --- */
.tag.row2 {
  background: transparent;
  border: 1.5px solid #ff7a00;
  color: #ff7a00;
}
.tag.row2:hover {
  transform: scale(1.08);
  background: rgba(255, 122, 0, 0.15);
  box-shadow: 0 0 10px rgba(255, 136, 0, 0.5);
}

/* --- 3段目：半透明背景 --- */
.tag.row3 {
  background: rgba(255, 122, 0, 0.25);
  border: 1px solid #ff7a00;
  color: #fff;
}
.tag.row3:hover {
  transform: scale(1.08);
  background: rgba(255, 122, 0, 0.45);
  box-shadow: 0 0 10px rgba(255, 136, 0, 0.6);
}

/* 無限ループ用クローン */
.clone { opacity: 0.85; }

/* 横スクロールアニメーション */
@keyframes scroll-loop {
  from { transform: translateX(0); }
  to { transform: translateX(-50%); }
}

/* 各段スピード変化 */
.scroll-row.row1 { animation-duration: 320s; } /* ゆっくり */
.scroll-row.row2 { animation-duration: 300s; } /* 少し速く */
.scroll-row.row3 { animation-duration: 340s; } /* 一番ゆっくり */

/* === レスポンシブ === */
@media (max-width: 1024px) {
  .tag { font-size: 0.8rem; padding: 3px 8px; }
}
@media (max-width: 768px) {
  .tag { font-size: 0.75rem; padding: 2px 6px; }
}
@media (max-width: 480px) {
  .tag { font-size: 0.7rem; padding: 2px 5px; border-radius: 14px; }
}
</style>
